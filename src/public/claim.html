<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Claim Tokens | Kea Valley</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ee9d2b",
                        "primary-light": "#fbdea6",
                        "background-dark": "#0a0a0a",
                        "surface": "#121212",
                    },
                    fontFamily: {
                        "sans": ["Manrope", "sans-serif"],
                        "serif": ["Playfair Display", "serif"],
                    },
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Manrope', sans-serif; }
        h1, h2, h3, h4, .font-serif { font-family: 'Playfair Display', serif; }
        .gold-glow:hover {
            box-shadow: 0 0 25px rgba(238, 157, 43, 0.3);
            border-color: #ee9d2b;
        }
        .glass-nav {
            backdrop-filter: blur(12px);
            background-color: rgba(10, 10, 10, 0.7);
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #ee9d2b; }
    </style>
</head>
<body class="bg-background-dark text-white selection:bg-primary selection:text-background-dark antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass-nav border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 lg:px-12 flex items-center justify-between h-20 lg:h-24">
            <a href="/" class="flex items-center gap-4 group cursor-pointer">
                <div class="size-10 text-primary transition-transform duration-500 group-hover:rotate-180">
                    <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                        <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
                    </svg>
                </div>
                <div>
                    <h2 class="text-xl font-serif font-bold tracking-widest uppercase text-white">Kea Valley</h2>
                    <p class="text-[0.6rem] text-primary uppercase tracking-[0.3em] font-sans">Estates</p>
                </div>
            </a>
            <nav class="hidden md:flex items-center gap-8 lg:gap-12">
                <a class="text-xs font-bold tracking-widest hover:text-primary transition-colors uppercase" href="/">Home</a>
                <a class="text-xs font-bold tracking-widest hover:text-primary transition-colors uppercase" href="/profile">My Profile</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 pt-32 pb-20 px-6 flex items-center justify-center">
        <div class="max-w-lg mx-auto w-full">
            
            <!-- Page Title -->
            <div class="text-center mb-12">
                <div class="flex items-center justify-center gap-4 mb-6">
                    <div class="h-[1px] w-8 bg-primary"></div>
                    <span class="text-primary tracking-[0.3em] uppercase text-xs font-bold">Token Claim</span>
                    <div class="h-[1px] w-8 bg-primary"></div>
                </div>
                <h1 class="text-4xl md:text-5xl font-serif italic font-medium text-white mb-4">Claim Your Tokens</h1>
                <p class="text-slate-400 font-light">Receive your free VIP tokens to join the Kea Valley community.</p>
            </div>

            <!-- Card -->
            <div class="bg-surface border border-white/5 rounded-sm overflow-hidden">
                <div class="px-8 py-5 border-b border-white/5 flex items-center justify-between">
                    <h3 class="text-xs font-bold uppercase tracking-widest text-primary">Claim Status</h3>
                    <span class="material-symbols-outlined text-primary/50">redeem</span>
                </div>
                <div class="p-8">
                    
                    <!-- Status Display -->
                    <div id="claimStatus" class="text-center py-8">
                        <div class="w-12 h-12 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                        <p class="text-slate-400 text-sm">Processing your claim...</p>
                    </div>

                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-background-dark py-8 border-t border-white/5">
        <div class="max-w-7xl mx-auto px-6 lg:px-12">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <a href="/" class="flex items-center gap-2">
                    <div class="size-6 text-primary">
                        <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <span class="text-xs font-serif font-bold tracking-widest uppercase text-white">Kea Valley</span>
                </a>
                <div class="text-slate-600 text-xs font-light">
                    Â© 2026 Kea Valley
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const walletAddress = urlParams.get('wallet') || urlParams.get('address');
        const signature = urlParams.get('signature');
        const message = urlParams.get('message');

        const statusEl = document.getElementById('claimStatus');

        async function processClaim() {
            if (!walletAddress) {
                statusEl.innerHTML = `
                    <div class="size-16 mx-auto rounded-full bg-red-500/10 border border-red-500/20 flex items-center justify-center mb-6">
                        <span class="material-symbols-outlined text-red-400 text-3xl">error</span>
                    </div>
                    <h3 class="text-xl font-serif text-white mb-2">No Wallet Detected</h3>
                    <p class="text-slate-500 text-sm mb-8">Please connect your wallet to claim tokens.</p>
                    <a href="https://wallet.wallettwo.com/auth/login?companyId=6a27c2f8-894c-46c7-bf9f-f5af11d4e092&action=signature&message=FREE_BONUS_TOKENS_KEA_VALLEY&redirect_uri=https://kea-valley.com/claim" class="inline-block bg-primary text-background-dark px-8 py-4 rounded-sm font-bold uppercase tracking-widest text-xs gold-glow hover:translate-y-[-2px] transition-transform">
                        Connect Wallet
                    </a>
                `;
                return;
            }

            try {
                const response = await fetch('/api/claim/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        wallet_address: walletAddress,
                        signature: signature,
                        message: message
                    })
                });

                const data = await response.json();

                if (response.status === 201) {
                    // Success
                    statusEl.innerHTML = `
                        <div class="size-16 mx-auto rounded-full bg-green-500/10 border border-green-500/20 flex items-center justify-center mb-6">
                            <span class="material-symbols-outlined text-green-400 text-3xl">check_circle</span>
                        </div>
                        <h3 class="text-xl font-serif text-white mb-2">Tokens Claimed!</h3>
                        <p class="text-slate-400 text-sm mb-4">${data.message || 'Your VIP tokens have been minted successfully.'}</p>
                        ${data.tx_hash ? `
                            <a href="${data.explorer_url}" target="_blank" class="inline-flex items-center gap-2 text-primary text-xs hover:underline mb-8">
                                View Transaction <span class="material-symbols-outlined text-sm">open_in_new</span>
                            </a>
                        ` : ''}
                        <div class="pt-4">
                            <a href="/profile" class="inline-block bg-primary text-background-dark px-8 py-4 rounded-sm font-bold uppercase tracking-widest text-xs gold-glow hover:translate-y-[-2px] transition-transform">
                                View My Profile
                            </a>
                        </div>
                    `;
                } else if (response.status === 409) {
                    // Already claimed
                    statusEl.innerHTML = `
                        <div class="size-16 mx-auto rounded-full bg-primary/10 border border-primary/20 flex items-center justify-center mb-6">
                            <span class="material-symbols-outlined text-primary text-3xl">info</span>
                        </div>
                        <h3 class="text-xl font-serif text-white mb-2">Already Claimed</h3>
                        <p class="text-slate-400 text-sm mb-8">${data.message || 'This wallet has already claimed tokens.'}</p>
                        <a href="/profile" class="inline-block bg-primary text-background-dark px-8 py-4 rounded-sm font-bold uppercase tracking-widest text-xs gold-glow hover:translate-y-[-2px] transition-transform">
                            View My Profile
                        </a>
                    `;
                } else {
                    // Error
                    statusEl.innerHTML = `
                        <div class="size-16 mx-auto rounded-full bg-red-500/10 border border-red-500/20 flex items-center justify-center mb-6">
                            <span class="material-symbols-outlined text-red-400 text-3xl">error</span>
                        </div>
                        <h3 class="text-xl font-serif text-white mb-2">Claim Failed</h3>
                        <p class="text-slate-500 text-sm mb-8">${data.message || data.error || 'An error occurred. Please try again.'}</p>
                        <a href="/" class="inline-block border border-primary/30 text-primary px-8 py-4 rounded-sm font-bold uppercase tracking-widest text-xs hover:bg-primary hover:text-background-dark transition-all">
                            Return Home
                        </a>
                    `;
                }
            } catch (error) {
                statusEl.innerHTML = `
                    <div class="size-16 mx-auto rounded-full bg-red-500/10 border border-red-500/20 flex items-center justify-center mb-6">
                        <span class="material-symbols-outlined text-red-400 text-3xl">error</span>
                    </div>
                    <h3 class="text-xl font-serif text-white mb-2">Connection Error</h3>
                    <p class="text-slate-500 text-sm mb-8">Unable to connect to the server. Please try again.</p>
                    <button onclick="location.reload()" class="inline-block border border-primary/30 text-primary px-8 py-4 rounded-sm font-bold uppercase tracking-widest text-xs hover:bg-primary hover:text-background-dark transition-all">
                        Try Again
                    </button>
                `;
            }
        }

        // Process claim on page load
        processClaim();
    </script>
</body>
</html>
